// ASDIG Database Schema
// Attendance System for Elementary School

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model for authentication (Teachers and Admins)
model User {
  id        String   @id @default(cuid())
  name      String
  username  String   @unique
  password  String   // Will be hashed with bcrypt
  role      UserRole
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Optional teacher assignment
  classId String? @unique

  // Relations
  class Class? @relation(fields: [classId], references: [id], onDelete: SetNull)

  @@map("users")
}

// Class model
model Class {
  id           String @id @default(cuid())
  name         String @unique
  studentCount Int    @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  teacher  User?       @relation
  students Student[]
  attendanceRecords AttendanceRecord[]

  @@map("classes")
}

// Student model
model Student {
  id          String   @id @default(cuid())
  name        String
  classId     String
  nisn        String   @unique
  gender      Gender
  birthDate   String
  address     String?
  parentName  String?
  parentPhone String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  class             Class              @relation(fields: [classId], references: [id])
  attendanceRecords AttendanceRecord[]

  @@map("students")
}

// Attendance Record model
model AttendanceRecord {
  id        String           @id @default(cuid())
  studentId String
  classId   String
  date      String
  status    AttendanceStatus
  notes     String?
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt

  // Relations
  student Student @relation(fields: [studentId], references: [id])
  class   Class   @relation(fields: [classId], references: [id])

  @@unique([studentId, date])
  @@map("attendance_records")
}

// Enums
enum UserRole {
  ADMIN
  TEACHER
}

enum Gender {
  MALE
  FEMALE
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  SICK
  PERMISSION
}
